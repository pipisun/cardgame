//Dim screenX, screenY
//Dim intX, intY
//
//Dim count, isFound 
//
//screenX = GetScreenX()
//screenY = GetScreenY()
//TracePrint "Screen size:", screenX, screenY
//
//'Run app
//RunApp "com.tether.solitaire.klondike"
//
//count = 30
//While count > 0 
//	FindPic 0, 0, 0, 0, "Attachment:playnow.png", "000000", 0, 0.7, intX, intY
//	If intX > 0 And intY > 0 Then 
//		TracePrint "Found Playnow button"
//	
//		Tap intX, intY
//		Exit While
//	Else 
//		TracePrint "Continue searching playnow..."	
//	End If
//	count = count - 1
//	Delay 1000
//Wend
//
//'Tap Play Now
//'Tap screenX / 2, screenY - 60
//
//'Choose game
//count = 30
//isFound = False
//
//TracePrint "Searching entry z1"
//While count > 0 
//	FindPic 0, 0, 0, 0, "Attachment:entryz1.png", "000000", 0, 0.7, intX, intY
//	If intX > 0 And intY > 0 Then 
//		TracePrint "Found entry z1"
//
//		isFound = True
//		Exit While
//	Else 
//		TracePrint "Continue searching z1..."	
//	End If
//	count = count - 1
//	Delay 1000
//Wend
//
//If Not isFound Then 
//	TracePrint "Not found entryz1"
//Else 
//	Delay 2000
//	Tap intX, intY	
//End If
//
//'Tap Start Game
//count = 30
//While count > 0 
//	FindPic 0, 0, 0, 0, "Attachment:startgame.png", "000000", 0, 0.7, intX, intY
//	If intX > 0 And intY > 0 Then 
//		TracePrint "Found Startgame button"
//
//		Tap intX, intY
//		Exit While
//	Else 
//		TracePrint "Continue searching startgame..."	
//	End If
//	count = count - 1
//	Delay 1000
//Wend
//
//'Waiting game to start
//count = 30
//While count > 0 
//	FindPic 0, 800, 320, 960, "Attachment:endbutton.png", "000000", 0, 0.7, intX, intY
//	If intX > 0 And intY > 0 Then 
//		TracePrint "Found Endbutton button"
//
//		Delay 1000
//		Exit While
//	Else 
//		TracePrint "Continue searching Endbutton..."	
//	End If
//	count = count - 1
//	Delay 1000
//Wend

'Save card info(point, suit) and card position
Dim cardInfoArr(7,2), cardPosArr(7,2)
Dim allCardPicArr, suitPicArr
Dim intX, intY

allCardPicArr = Array("b1.png", "r1.png", "b2.png", "r2.png", "b3.png", "r3.png", "b4.png", "r4.png", "b5.png", "r5.png", "b6.png", "r6.png", "b7.png", _
"r7.png", "b8.png", "r8.png", "b9.png", "r9.png", "b10.png", "r10.png", "b11.png", "r11.png", "b12.png", "r12.png", "b13.png", "r13.png")

suitPicArr = Array("spade.png", "spade2.png", "heart.png", "club.png", "diamond.png")

Dim leftUpperCornerX, leftUpperCornerY
Dim rightUpperCornerX, rightUpperCornerY
leftUpperCornerX = 2
leftUpperCornerY = 215
rightUpperCornerX = 45
rightUpperCornerY = 332

Dim leftUpperCornerXForSuit, leftUpperCornerYForSuit
Dim rightUpperCornerXForSuit, rightUpperCornerYForSuit
leftUpperCornerXForSuit = 45
leftUpperCornerYForSuit = 215
rightUpperCornerXForSuit = 93
rightUpperCornerYForSuit = 332

Dim offsetX1, offsetX2
offsetX1 = 91
offsetX2 = 95

Dim cardPoint
Dim cardSearchArea(7,4), suitSearchArea(7,4)

For i = 0 To 6
	TracePrint "Finding card in (", leftUpperCornerX, leftUpperCornerY, rightUpperCornerX, rightUpperCornerY, ") area"
	For j = 0 To 25
		FindPic leftUpperCornerX, leftUpperCornerY, rightUpperCornerX, rightUpperCornerY, "Attachment:" & allCardPicArr(j), "000000", 0, 0.7, intX, intY
//		TracePrint "Finding ", allCardPicArr(j), " in (", leftUpperCornerX, leftUpperCornerY, rightUpperCornerX, rightUpperCornerY, ") area"
		If intX > 0 And intY > 0 Then 
			'Get card point
			cardPoint = Mid(allCardPicArr(j), 2, InStr(1, allCardPicArr(j), ".") - 2) 
			TracePrint "Found card: ", cardPoint
			'Save card info
			cardInfoArr(i, 0) = cardPoint
			cardPosArr(i, 0) = intX
			cardPosArr(i, 1) = intY
			cardSearchArea(i,0) = leftUpperCornerX
			cardSearchArea(i,1) = leftUpperCornerY
			cardSearchArea(i,2) = rightUpperCornerX
			cardSearchArea(i, 3) = rightUpperCornerY
			
			TracePrint "Finding suit in (", leftUpperCornerXForSuit, leftUpperCornerYForSuit, rightUpperCornerXForSuit, rightUpperCornerYForSuit, ") area"
			
			For m = 0 To 4
				'Search suit
				FindPic leftUpperCornerXForSuit, leftUpperCornerYForSuit, rightUpperCornerXForSuit, rightUpperCornerYForSuit, "Attachment:" & suitPicArr(m), "000000", 0, 0.7, intX, intY
				If intX > 0 And intY > 0 Then 
					TracePrint "Found suit: ", suitPicArr(m)
					'Save suit info
					cardInfoArr(i, 1) = convertSuitColorToSign(suitPicArr(m))
					
					suitSearchArea(i,0) = leftUpperCornerXForSuit
					suitSearchArea(i,1) = leftUpperCornerYForSuit
					suitSearchArea(i,2) = rightUpperCornerXForSuit
					suitSearchArea(i,3) = rightUpperCornerYForSuit
					
					Exit For
				End If
			Next
			Exit For
		End If
	Next
	leftUpperCornerX = leftUpperCornerX + offsetX1
	rightUpperCornerX = rightUpperCornerX + offsetX2
	leftUpperCornerXForSuit = leftUpperCornerXForSuit + offsetX1
	rightUpperCornerXForSuit = rightUpperCornerXForSuit + offsetX2
Next

Call sortMaxToMin()
For i = 0 To 6
	TracePrint "Card point:", cardInfoArr(i,0)
	TracePrint "Card position(x,y):", cardPosArr(i,0), ",", cardPosArr(i,1)
	TracePrint "Card suit color:", cardInfoArr(i,1)
Next

'Comparison
Dim number1, number2
Dim compareCounter 
compareCounter = 1
For i = 0 To 5
	If cardInfoArr(i,0) <> "?" Then
		number1 = CInt(cardInfoArr(i,0))
		For j = i+1 To 6
				If cardInfoArr(j,0) <> "?" Then
					If number1 - compareCounter = number2 And cardInfoArr(i,1) <> cardInfoArr(j,1) Then
						cardInfoArr(i,0) = cardInfoArr(i,0) + "|" + cardInfoArr(j,0)
						Swipe cardPosArr(j,0), cardPosArr(j,1), cardPosArr(i,0), cardPosArr(i, 1)
						compareCounter = compareCounter + 1
						
						'Identify the new card
						Call identifyNewCard(j)

					Else
						Exit For
					End If
				End If
		Next
		compareCounter = 1
	End If
Next

Sub identifyNewCard(j)
	Dim intX, intY
	Dim cardPoint
	
	For m = 0 To 25
		'Search again after the card is moved
		FindPic cardSearchArea(j,0), cardSearchArea(j,1), cardSearchArea(j,2), cardSearchArea(j,3), "Attachment:" & allCardPicArr(j), "000000", 0, 0.7, intX, intY
		If intX > 0 And intY > 0 Then
			'Get card point
			cardPoint = Mid(allCardPicArr(j), 2, Len(allCardPicArr(j))) 
			TracePrint "Found card: ", cardPoint
			
			cardInfoArr(j,0) = cardPoint
			'Search suit
			For s = 0 To 3
				FindPic suitSearchArea(j,0), suitSearchArea(j,1), suitSearchArea(j,2), suitSearchArea(j,3), "Attachment:" & suitPicArr(s), "000000", 0, 0.7, intX, intY
				If intX > 0 And intY > 0 Then 
					TracePrint "Found suit: ", suitPicArr(s)
					'Save suit info
					cardInfoArr(j, 1) = convertSuitColorToSign(suitPicArr(s))
				End If
			Next
		End If 
	Next 
End Sub

Function convertSuitColorToSign(strSuit)
	If strSuit = "spade.png" Or strSuit = "spade2.png" Or strSuit = "club.png" Then
		strSuit = "Black"
	ElseIf strSuit = "heart.png" Or strSuit = "diamond.png" Then
		strSuit = "Red"
	End If
	
	convertSuitColorToSign = strSuit
End Function

Sub sortMaxToMin()
	Dim a, b
	Dim posx, posy
	Dim temp, suitTemp
	
	For i = 0 To 5
		For j = i + 1 To 6
			a = CInt(cardInfoArr(i, 0))
			b = CInt(cardInfoArr(j, 0))
			
			'TracePrint "a:", a, ", b:", b
			
			If a < b Then 
				temp = cardInfoArr(i, 0)
				cardInfoArr(i, 0) = cardInfoArr(j, 0)
				cardInfoArr(j, 0) = temp
				
				'Update position array
				posx = cardPosArr(i, 0)
				posy = cardPosArr(i, 1)
				cardPosArr(i, 0) = cardPosArr(j, 0)
				cardPosArr(i, 1) = cardPosArr(j, 1)
				cardPosArr(j,0)=posx
				cardPosArr(j, 1) = posy
				
				'Update suit info
				suitTemp = cardInfoArr(i, 1)
				cardInfoArr(i, 1) = cardInfoArr(j, 1)
				cardInfoArr(j, 1) = suitTemp
			End If
		Next 
	Next 
End Sub